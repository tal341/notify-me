<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⏰ תזכורות חכמות</title>
    <style>
        :root {
            --bg: #1e1e2f;
            --card: #2a2a3d;
            --accent: #00ff88;
            --text: #e0e0ff;
            --radius: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, Arial, Helvetica, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem 1rem;
        }
        .container {
            width: 100%;
            max-width: 560px;
        }
        h1 {
            font-size: 2.2rem;
            text-align: center;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }
        input, select, textarea, button {
            width: 100%;
            font-size: 1rem;
            padding: .8rem 1rem;
            margin-top: .5rem;
            border: none;
            border-radius: var(--radius);
        }
        input, select, textarea {
            background: #3a3a5a;
            color: #fff;
        }
        button {
            background: var(--accent);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: transform .1s;
        }
        button:hover { transform: scale(1.02); }
        button:active { transform: scale(.98); }
        .small { font-size: .9rem; }
        .mt { margin-top: 1rem; }
        .center { text-align: center; }
        #songPreview {
            margin-top: .8rem;
            text-align: center;
        }
        #songPreview audio {
            width: 100%;
            margin-top: .4rem;
        }
        #messagePreview {
            margin-top: .8rem;
            padding: .6rem;
            background: #3a3a5a;
            border-radius: var(--radius);
            font-style: italic;
        }
        @media (max-width: 480px) {
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⏰ תזכורות חכמות</h1>

        <div class="card">
            <h2 class="small">🗒️ שם & זמן</h2>
            <input id="title" type="text" placeholder="שם התזכורת (לדוגמה: לקחת תרופה)" required>
            <input id="time" type="time" required>

            <h2 class="small mt">🎵 שיר (אופציונלי)</h2>
            <input id="songQuery" type="text" placeholder="חפש ביוטיוב או הדבק קישור MP3">
            <button id="searchBtn" class="small">🔎 חפש שיר</button>

            <div id="songPreview"></div>

            <h2 class="small mt">⏱️ קטע מהשיר (אופציונלי)</h2>
            <div class="small">הזנת זמן בפורמט <b>mm:ss</b> – לדוגמה 00:30 (30 שניות)</div>
            <input id="startSec" type="text" placeholder="התחלה (mm:ss)" class="small">
            <input id="endSec"   type="text" placeholder="סיום (mm:ss)" class="small">

            <h2 class="small mt">💬 הודעה מותאמת</h2>
            <textarea id="msg" rows="2" placeholder="הודעה שתופיע (אם ריק – נוצרה הודעה אוטומטית)"></textarea>
            <select id="msgStyle" class="small">
                <option value="normal">רגילה</option>
                <option value="funny">הומוריסטית</option>
                <option value="motiv">מעודדת</option>
            </select>
            <div id="messagePreview"></div>

            <h2 class="small mt">🔊 ווליום</h2>
            <input type="range" id="volume" min="0" max="100" value="70">
            <div class="small">עוצמה: <span id="volDisplay">70%</span></div>

            <button id="addBtn" class="mt">✨ הוסף תזכורת</button>
        </div>

        <div class="card">
            <h2 class="small">📋 תזכורות פעילות</h2>
            <div id="list"></div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'smartReminders';
        let reminders = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let selectedSong = null;

        // פונקציות עזר
        function toSec(str) {
            const [m, s] = str.split(':').map(Number);
            return (isNaN(m) ? 0 : m) * 60 + (isNaN(s) ? 0 : s);
        }

        function generateMessage(title, style) {
            const base = `היי! הגיע הזמן ל-${title}.`;
            if(style==='funny')   return `${base} 😆 אל תתן לשעון לשקר אותך!`;
            if(style==='motiv')   return `${base} 💪 תזכור – כל צעד קטן מוביל להצלחה!`;
            return base; // normal
        }

        // חיפוש שיר ביוטיוב (ללא API)
        async function searchYouTube(query) {
            const url = `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`;
            const resp = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
            const html = await resp.text();
            const videoIdMatch = html.match(/data-video-id="([^"]+)"/);
            if (!videoIdMatch) return null;
            return { id: videoIdMatch[1], title: query };
        }

        // בחירת שיר
        async function handleSearch() {
            const q = document.getElementById('songQuery').value.trim();
            if(!q) return;
            const preview = document.getElementById('songPreview');
            preview.innerHTML = '<p class="small">מחפש…</p>';

            // אם הקישור הוא MP3 ישיר
            if(q.match(/\.(mp3|wav|ogg)(\?.*)?$/i)){
                selectedSong = { type: 'url', url: q, title: 'קובץ MP3' };
                preview.innerHTML = `
                    <audio controls src="${q}"></audio>
                    <button class="small" onclick="selectSong('${q}','קובץ MP3')">בחר קובץ זה</button>
                `;
                return;
            }

            // חיפוש ביוטיוב
            const result = await searchYouTube(q);
            if(!result){
                preview.innerHTML = '<p class="small">לא נמצא שיר.</p>';
                return;
            }

            selectedSong = { type: 'yt', id: result.id, title: result.title };
            preview.innerHTML = `
                <p class="small">נבחר: ${result.title}</p>
                <iframe width="100%" height="200"
                    src="https://www.youtube.com/embed/${result.id}"
                    frameborder="0"
                    allow="autoplay; encrypted-media"
                    allowfullscreen></iframe>
            `;
        }

        // הוספת תזכורת
        function addReminder() {
            const title   = document.getElementById('title').value.trim();
            const timeStr = document.getElementById('time').value;
            const msgRaw  = document.getElementById('msg').value.trim();
            const style   = document.getElementById('msgStyle').value;
            const start   = toSec(document.getElementById('startSec').value);
            const end     = toSec(document.getElementById('endSec').value);
            const volume  = document.getElementById('volume').value;

            if(!title || !timeStr){
                alert('הכנס שם וזמן.');
                return;
            }

            const now = new Date();
            const [h,m] = timeStr.split(':').map(Number);
            const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0, 0);
            if(target <= now) target.setDate(target.getDate()+1);
            const delay = target.getTime() - now.getTime();

            const reminder = {
                id: Date.now(),
                title,
                time: timeStr,
                target: target.getTime(),
                msg: msgRaw || generateMessage(title, style),
                song: selectedSong,
                start,
                end,
                volume,
                active:true
            };

            reminders.push(reminder);
            saveReminders();
            renderList();
            schedule(reminder, delay);
            clearForm();
        }

        // פונקציות נוספות (שמירה, תצוגה, תזמון)
        function saveReminders() { localStorage.setItem(STORAGE_KEY, JSON.stringify(reminders)); }
        function renderList() { /* קוד תצוגה */ }
        function schedule(rem, delay) { setTimeout(()=>showNotification(rem), delay); }
        function showNotification(rem) { /* קוד התראה */ }

        // אתחול
        function init() {
            document.getElementById('searchBtn').addEventListener('click', handleSearch);
            document.getElementById('addBtn').addEventListener('click', addReminder);
            document.getElementById('volume').addEventListener('input', () => {
                document.getElementById('volDisplay').textContent = document.getElementById('volume').value + '%';
            });
            renderList();
        }
        init();
    </script>
</body>
</html>
