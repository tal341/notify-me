<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>â° ×ª×–×›×•×¨×•×ª ×—×›××•×ª â€“ ×¤×©×•×˜ ×•× ×•×—</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="https://img.icons8.com/ios-filled/50/000000/alarm.png">

<!-- ==== ×¢×™×¦×•×‘ ××•×“×¨× ×™ ×•× ×§×™ ==== -->
<style>
:root{
    --bg:#1e1e2f;          /* ×¨×§×¢ ×›×”×” */
    --card:#2a2a3d;        /* ×›×¨×˜×™×¡×™× */
    --accent:#00ff88;      /* ×¦×‘×¢ ××•×“×’×© */
    --text:#e0e0ff;        /* ×˜×§×¡×˜ */
    --radius:12px;
    --shadow:0 4px 12px rgba(0,0,0,.4);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family:system-ui,Arial,Helvetica,sans-serif;
    background:var(--bg);
    color:var(--text);
    line-height:1.5;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:2rem 1rem;
}
.container{
    width:100%;
    max-width:560px;
}
h1{
    font-size:2.2rem;
    text-align:center;
    margin-bottom:1rem;
    color:var(--accent);
}
.card{
    background:var(--card);
    border-radius:var(--radius);
    padding:1.5rem;
    margin-bottom:1.5rem;
    box-shadow:var(--shadow);
}
input,select,textarea,button{
    width:100%;
    font-size:1rem;
    padding:.8rem 1rem;
    margin-top:.5rem;
    border:none;
    border-radius:var(--radius);
}
input,select,textarea{
    background:#3a3a5a;
    color:#fff;
}
button{
    background:var(--accent);
    color:#000;
    font-weight:bold;
    cursor:pointer;
    transition:transform .1s;
}
button:hover{transform:scale(1.02);}
button:active{transform:scale(.98);}
.small{font-size:.9rem;}
.mt{margin-top:1rem;}
.center{text-align:center;}
#songPreview{
    margin-top:.8rem;
    text-align:center;
}
#songPreview audio{
    width:100%;
    margin-top:.4rem;
}
#messagePreview{
    margin-top:.8rem;
    padding:.6rem;
    background:#3a3a5a;
    border-radius:var(--radius);
    font-style:italic;
}
.volume-control{
    display:flex;
    align-items:center;
    gap:.5rem;
    margin-top:.5rem;
}
.volume-control input[type="range"]{
    flex:1;
}
.optional{color:#aaa;}

@media (max-width:480px){
    h1{font-size:1.8rem;}
}
</style>
</head>

<body>
<div class="container">

    <h1>â° ×ª×–×›×•×¨×•×ª ×—×›××•×ª</h1>

    <!-- ====================  ×˜×•×¤×¡ ×™×¦×™×¨×ª ×ª×–×›×•×¨×ª ==================== -->
    <div class="card">
        <h2 class="small">ğŸ—’ï¸ ×©× & ×–××Ÿ</h2>
        <input id="title" type="text" placeholder="×©× ×”×ª×–×›×•×¨×ª (×—×•×‘×”)" required>
        <input id="time" type="time" required>

        <h2 class="small mt">ğŸµ ×©×™×¨ (××•×¤×¦×™×•× ×œ×™)</h2>
        <input id="songQuery" type="text" placeholder="×—×¤×© ×‘×™-×˜×•×‘ ××• ×”×“×‘×§ ×§×™×©×•×¨ MP3">
        <button id="searchBtn" class="small">ğŸ” ×—×¤×© ×©×™×¨</button>
        <div id="songPreview"></div>

        <h2 class="small mt optional">â±ï¸ ×§×˜×¢ ××”×©×™×¨ (××•×¤×¦×™×•× ×œ×™)</h2>
        <div class="small optional">×”×–× ×ª ×–××Ÿ ×‘×¤×•×¨××˜ mm:ss (×œ×“×•×’××” 00:30)</div>
        <input id="startSec" type="text" placeholder="×”×ª×—×œ×” (mm:ss)" class="small">
        <input id="endSec"   type="text" placeholder="×¡×™×•× (mm:ss)" class="small">

        <h2 class="small mt">ğŸ’¬ ×”×•×“×¢×” (××•×¤×¦×™×•× ×œ×™)</h2>
        <textarea id="msg" rows="2" placeholder="×”×•×“×¢×” ×©×ª×•×¤×™×¢ (×× ×¨×™×§ â€“ × ×•×¦×¨×” ×”×•×“×¢×” ××•×˜×•××˜×™×ª)"></textarea>
        <select id="msgStyle" class="small">
            <option value="normal">×¨×’×™×œ×”</option>
            <option value="funny">×”×•××•×¨×™×¡×˜×™×ª</option>
            <option value="motiv">××¢×•×“×“×ª</option>
        </select>
        <div id="messagePreview"></div>

        <h2 class="small mt">ğŸ”Š ×¢×•×¦××ª ×¦×œ×™×œ (××•×¤×¦×™×•× ×œ×™)</h2>
        <div class="volume-control">
            <span>ğŸ”ˆ</span>
            <input type="range" id="volume" min="0" max="100" value="70">
            <span>ğŸ”Š</span>
            <span id="volumeDisplay">70%</span>
        </div>

        <button id="addBtn" class="mt">âœ¨ ×”×•×¡×£ ×ª×–×›×•×¨×ª</button>
    </div>

    <!-- ====================  ×¨×©×™××ª ×ª×–×›×•×¨×•×ª ==================== -->
    <div class="card">
        <h2 class="small">ğŸ“‹ ×ª×–×›×•×¨×•×ª ×¤×¢×™×œ×•×ª</h2>
        <div id="list"></div>
    </div>

</div>

<!-- ==== ×§×•×“ JavaScript ==== -->
<script>
/* ====================  ×§×‘×•×¢×™× ×•×”×’×“×¨×•×ª ==================== */
const STORAGE_KEY = 'smartReminders';
let reminders = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let selectedSong = null;   // {type:'yt'|'url'|null, id:..., title:...}

/* ====================  ×¢×–×¨×™ ×–××Ÿ ==================== */
function toSec(str){                     // "mm:ss" â†’ ×©× ×™×•×ª
    if(!str) return 0;
    const [m,s] = str.split(':').map(Number);
    return (isNaN(m)?0:m)*60 + (isNaN(s)?0:s);
}
function toMMSS(sec){
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
}

/* ====================  ×”×•×“×¢×•×ª AI (×¤×©×•×˜) ==================== */
function generateMessage(title, style){
    const base = `×”×™×™! ×”×’×™×¢ ×”×–××Ÿ ×œâ€‘${title}.`;
    if(style==='funny')   return `${base} ğŸ˜† ××œ ×ª×ª×Ÿ ×œ×©×¢×•×Ÿ ×œ×©×§×¨ ××•×ª×š!`;
    if(style==='motiv')   return `${base} ğŸ’ª ×ª×–×›×•×¨ â€“ ×›×œ ×¦×¢×“ ×§×˜×Ÿ ××•×‘×™×œ ×œ×”×¦×œ×—×”!`;
    return base; // normal
}

/* ====================  ×—×™×¤×•×© ×©×™×¨ (××•×¤×¦×™×•× ×œ×™) ==================== */
function searchYouTube(query){
    // ×œ×œ× API â€“ × ×¦×™×’ ×§×™×©×•×¨ ×™×©×™×¨×•×ª ×œ××©×ª××©
    const preview = document.getElementById('songPreview');
    preview.innerHTML = `
        <p class="small">××™×Ÿ API â€“ <b>×”×“×‘×§ ×§×™×©×•×¨ MP3 ×™×©×™×¨×•×ª</b> ××• ×”×©××¨ ×¨×™×§.</p>
        <button class="small" onclick="selectSong(null)">ğŸš« ×œ×œ× ×©×™×¨</button>
    `;
}

/* ====================  ×”×¦×’×ª ×ª×•×¦××•×ª ×—×™×¤×•×© ==================== */
function handleSearch(){
    const q = document.getElementById('songQuery').value.trim();
    if(!q) return searchYouTube(q);
    
    const preview = document.getElementById('songPreview');
    preview.innerHTML = '<p class="small">×˜×•×¢×Ÿâ€¦</p>';

    // ×× ×”×§×™×©×•×¨ ×”×•× MP3 ×™×©×™×¨ â€“ × ×¦×™×’ ×™×©×™×¨×•×ª
    if(q.match(/\.(mp3|wav|ogg)(\?.*)?$/i)){
        preview.innerHTML = `
            <audio controls src="${q}"></audio>
            <button class="small" onclick="selectSong('${q}','×§×•×‘×¥ MP3')">×‘×—×¨ ×§×•×‘×¥ ×–×”</button>
            <button class="small" onclick="selectSong(null)">ğŸš« ×œ×œ× ×©×™×¨</button>
        `;
        return;
    }

    // ×× ×œ× â€“ × ×¦×™×’ ×§×™×©×•×¨ YouTube
    preview.innerHTML = `
        <p class="small">×œ× × ×™×ª×Ÿ ×œ×—×¤×© ×œ×œ× API â€“ <b>×”×“×‘×§ ×§×™×©×•×¨ MP3</b></p>
        <button class="small" onclick="selectSong(null)">ğŸš« ×œ×œ× ×©×™×¨</button>
    `;
}

/* ====================  ×‘×—×™×¨×ª ×©×™×¨ (×›×•×œ×œ ×œ×œ× ×©×™×¨) ==================== */
function selectSong(idOrUrl, title){
    if(idOrUrl === null){
        selectedSong = null;
        document.getElementById('songPreview').innerHTML = '<p class="small">âœ… ×œ× × ×‘×—×¨ ×©×™×¨</p>';
        return;
    }
    if(idOrUrl.startsWith('http')){ // MP3 url
        selectedSong = {type:'url', url:idOrUrl, title};
    }else{ // YouTube id
        selectedSong = {type:'yt', id:idOrUrl, title};
    }
    document.getElementById('songPreview').innerHTML = `<p class="small">âœ… × ×‘×—×¨: ${title}</p>`;
}

/* ====================  ×ª×¦×•×’×ª ×”×•×“×¢×” ××•×ª×××ª ==================== */
document.getElementById('msg').addEventListener('input', updateMsgPreview);
document.getElementById('msgStyle').addEventListener('change', updateMsgPreview);
function updateMsgPreview(){
    const txt = document.getElementById('msg').value.trim();
    const style = document.getElementById('msgStyle').value;
    const title = document.getElementById('title').value.trim()||'×”×ª×–×›×•×¨×ª';
    const out = txt || generateMessage(title, style);
    document.getElementById('messagePreview').textContent = out;
}

/* ====================  ×‘×§×¨×ª ×¢×•×¦××” ==================== */
document.getElementById('volume').addEventListener('input', e=>{
    document.getElementById('volumeDisplay').textContent = e.target.value + '%';
});

/* ====================  ×”×•×¡×¤×ª ×ª×–×›×•×¨×ª ==================== */
document.getElementById('addBtn').addEventListener('click', addReminder);
function addReminder(){
    const title   = document.getElementById('title').value.trim();
    const timeStr = document.getElementById('time').value;
    const msgRaw  = document.getElementById('msg').value.trim();
    const style   = document.getElementById('msgStyle').value;
    const volume  = document.getElementById('volume').value;
    const start   = toSec(document.getElementById('startSec').value);
    const end     = toSec(document.getElementById('endSec').value);

    if(!title || !timeStr){
        alert('×”×›× ×¡ ×©× ×•×–××Ÿ.');
        return;
    }

    const now = new Date();
    const [h,m] = timeStr.split(':').map(Number);
    const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0, 0);
    if(target <= now) target.setDate(target.getDate()+1);
    const delay = target.getTime() - now.getTime();

    const reminder = {
        id: Date.now(),
        title,
        time: timeStr,
        target: target.getTime(),
        msg: msgRaw || generateMessage(title, style),
        song: selectedSong,
        start,
        end,
        volume: parseInt(volume),
        active:true
    };
    reminders.push(reminder);
    saveReminders();
    renderList();
    schedule(reminder, delay);
    clearForm();
}

/* ====================  ×©××™×¨×ª/×˜×¢×™× ×ª ×ª×–×›×•×¨×•×ª ==================== */
function saveReminders(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(reminders));
}

/* ====================  ×¨×™× ×“×•×¨ ×¨×©×™××ª ×ª×–×›×•×¨×•×ª ==================== */
function renderList(){
    const list = document.getElementById('list');
    if(reminders.length===0){
        list.innerHTML = '<p class="small">××™×Ÿ ×ª×–×›×•×¨×•×ª ×¤×¢×™×œ×•×ª.</p>';
        return;
    }
    list.innerHTML = reminders.map(r=>`
        <div class="small" style="margin:.6rem 0; padding:.6rem; background:#3a3a5a; border-radius:var(--radius);">
            <b>${r.title}</b> â€“ ${new Date(r.target).toLocaleTimeString('he-IL', {hour:'2-digit',minute:'2-digit'})}
            <br>×”×•×“×¢×”: ${r.msg}
            <br>×©×™×¨: ${r.song ? r.song.title : '×œ×œ×'}
            <br>×¢×•×¦××”: ${r.volume}%
            <br><button class="small" onclick="deleteReminder(${r.id})">ğŸ—‘ï¸ ××—×§</button>
        </div>
    `).join('');
}

/* ====================  ××—×™×§×ª ×ª×–×›×•×¨×ª ==================== */
function deleteReminder(id){
    reminders = reminders.filter(r=>r.id!==id);
    saveReminders();
    renderList();
}

/* ====================  × ×™×§×•×™ ×˜×•×¤×¡ ==================== */
function clearForm(){
    document.getElementById('title').value='';
    document.getElementById('time').value='';
    document.getElementById('songQuery').value='';
    document.getElementById('songPreview').innerHTML='';
    document.getElementById('msg').value='';
    document.getElementById('msgStyle').value='normal';
    document.getElementById('messagePreview').innerHTML='';
    document.getElementById('startSec').value='';
    document.getElementById('endSec').value='';
    document.getElementById('volume').value='70';
    document.getElementById('volumeDisplay').textContent='70%';
    selectedSong=null;
}

/* ====================  ×ª×–××•×Ÿ ×”×ª×¨××” ==================== */
function schedule(rem, delay){
    setTimeout(()=>showNotification(rem), delay);
}

/* ====================  ×”×¦×’×ª ×”×ª×¨××” ==================== */
async function showNotification(rem){
    // 1ï¸âƒ£ ×‘×§×©×ª ×”×¨×©××” (××ª×‘×¦×¢×ª ×¨×§ ×‘×¤×¢× ×”×¨××©×•× ×”)
    if(Notification.permission!=='granted'){
        try{
            await Notification.requestPermission();
        }catch(e){
            alert('×”×¨×©××” ×œ×”×ª×¨××•×ª × ×“×—×ª×” â€“ ×”×ª×–×›×•×¨×ª ×œ× ×ª×•×¤×™×¢.');
            return;
        }
    }

    // 2ï¸âƒ£ ×™×¦×™×¨×ª ×”×”×ª×¨××”
    const notif = new Notification(rem.title, {
        body: rem.msg,
        icon: 'https://img.icons8.com/ios-filled/50/000000/alarm.png'
    });

    // 3ï¸âƒ£ × ×’×Ÿ ××ª ×”×©×™×¨ (××• ×§×˜×¢ ××× ×•)
    const audio = new Audio();
    if(rem.song){
        if(rem.song.type==='url'){
            audio.src = rem.song.url;
        }else{
            // YouTube embed â€“ × ×©×ª××© ×‘×§×™×©×•×¨ ×™×©×™×¨ (×× ×™×©)
            audio.src = `https://www.youtube.com/watch?v=${rem.song.id}`;
        }
        audio.volume = rem.volume / 100;
        audio.currentTime = rem.start || 0;
        if(rem.end) audio.currentTime = rem.start; // × ×’×Ÿ ××”×”×ª×—×œ×”
        audio.loop = false;
        audio.play().catch(()=>{}); // ×‘××™×“×” ×©×”×“×¤×“×¤×Ÿ ×—×•×¡× autoplay
    }

    // 4ï¸âƒ£ ×›×¤×ª×•×¨ "×”×‘× ×ª×™" â€“ ×¡×•×’×¨ ××ª ×”×”×ª×¨××”
    notif.onclick = ()=>{ notif.close(); audio.pause(); };
}

/* ====================  ××ª×—×•×œ ×¨××©×•× ×™ ==================== */
function init(){
    // ×× ×™×© ×ª×–×›×•×¨×•×ª ×©××™×•×¢×“×•×ª ×œ×¢×ª×™×“ â€“ × ×–××Ÿ ××•×ª×Ÿ ××—×“×©
    const now = Date.now();
    reminders.forEach(r=>{
        if(r.active && r.target>now){
            schedule(r, r.target-now);
        }
    });
    renderList();
}
init();

/* ====================  ××™×¨×•×¢×™ ×œ×—×¦× ×™× ==================== */
document.getElementById('searchBtn').addEventListener('click', handleSearch);
</script>
</body>
</html>
