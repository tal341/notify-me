<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>â° ×ª×–×›×•×¨×•×ª ×—×›××•×ª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://img.icons8.com/ios-filled/50/000000/alarm.png">

    <style>
        :root {
            --bg: #1e1e2f;
            --card: #2a2a3d;
            --accent: #00ff88;
            --text: #e0e0ff;
            --radius: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, Arial, Helvetica, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem 1rem;
        }
        .container {
            width: 100%;
            max-width: 560px;
        }
        h1 {
            font-size: 2.2rem;
            text-align: center;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }
        input, select, textarea, button {
            width: 100%;
            font-size: 1rem;
            padding: .8rem 1rem;
            margin-top: .5rem;
            border: none;
            border-radius: var(--radius);
        }
        input, select, textarea {
            background: #3a3a5a;
            color: #fff;
        }
        button {
            background: var(--accent);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: transform .1s;
        }
        button:hover { transform: scale(1.02); }
        button:active { transform: scale(.98); }
        .small { font-size: .9rem; }
        .mt { margin-top: 1rem; }
        .center { text-align: center; }
        #songPreview {
            margin-top: .8rem;
            text-align: center;
        }
        #songPreview audio {
            width: 100%;
            margin-top: .4rem;
        }
        #messagePreview {
            margin-top: .8rem;
            padding: .6rem;
            background: #3a3a5a;
            border-radius: var(--radius);
            font-style: italic;
        }
        @media (max-width: 480px) {
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â° ×ª×–×›×•×¨×•×ª ×—×›××•×ª</h1>

        <div class="card">
            <h2 class="small">ğŸ—’ï¸ ×©× & ×–××Ÿ</h2>
            <input id="title" type="text" placeholder="×©× ×”×ª×–×›×•×¨×ª (×œ×“×•×’××”: ×œ×§×—×ª ×ª×¨×•×¤×”)" required>
            <input id="time" type="time" required>

            <h2 class="small mt">ğŸµ ×©×™×¨ (××•×¤×¦×™×•× ×œ×™)</h2>
            <label><input type="checkbox" id="useSong"> ×™×© ×©×™×¨ ××•×ª××</label>
            <div id="songContainer" style="display: none;">
                <input id="songQuery" type="text" placeholder="×—×¤×© ×‘×™×•×˜×™×•×‘ ××• ×”×“×‘×§ ×§×™×©×•×¨ MP3">
                <button id="searchBtn" class="small">ğŸ” ×—×¤×© ×©×™×¨</button>
                <div id="songPreview"></div>
                <div class="small mt">×‘×—×¨ ×§×˜×¢ (mm:ss)</div>
                <input id="startSec" type="text" placeholder="×”×ª×—×œ×” (mm:ss)" class="small">
                <input id="endSec" type="text" placeholder="×¡×™×•× (mm:ss)" class="small">
            </div>

            <h2 class="small mt">ğŸ’¬ ×”×•×“×¢×” ××•×ª×××ª</h2>
            <textarea id="msg" rows="2" placeholder="×”×•×“×¢×” ×©×ª×•×¤×™×¢ (×× ×¨×™×§ â€“ × ×•×¦×¨×” ×”×•×“×¢×” ××•×˜×•××˜×™×ª)"></textarea>
            <select id="msgStyle" class="small">
                <option value="normal">×¨×’×™×œ×”</option>
                <option value="funny">×”×•××•×¨×™×¡×˜×™×ª</option>
                <option value="motiv">××¢×•×“×“×ª</option>
            </select>
            <div id="messagePreview"></div>

            <h2 class="small mt">ğŸ”Š ×•×•×œ×™×•×</h2>
            <input type="range" id="volume" min="0" max="100" value="70" class="small">
            <div class="small">×¢×•×¦××”: <span id="volDisplay">70%</span></div>

            <button id="addBtn" class="mt">âœ¨ ×”×•×¡×£ ×ª×–×›×•×¨×ª</button>
        </div>

        <div class="card">
            <h2 class="small">ğŸ“‹ ×ª×–×›×•×¨×•×ª ×¤×¢×™×œ×•×ª</h2>
            <div id="list"></div>
        </div>
    </div>

    <script>
        const YT_API_KEY = ''; // ×”×›× ×¡ ×›××Ÿ ××¤×ª×— YouTube API (×—×™× ×) ×× ×ª×¨×¦×” ×—×™×¤×•×© ×××™×ª×™
        const STORAGE_KEY = 'smartReminders';
        let reminders = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

        function toSec(str) {
            const [m, s] = str.split(':').map(Number);
            return (isNaN(m) ? 0 : m) * 60 + (isNaN(s) ? 0 : s);
        }

        function generateMessage(title, style) {
            const base = `×”×™×™! ×”×’×™×¢ ×”×–××Ÿ ×œ-${title}.`;
            if (style === 'funny') return `${base} ğŸ˜† ××œ ×ª×ª×Ÿ ×œ×©×¢×•×Ÿ ×œ×©×§×¨ ××•×ª×š!`;
            if (style === 'motiv') return `${base} ğŸ’ª ×ª×–×›×•×¨ â€“ ×›×œ ×¦×¢×“ ×§×˜×Ÿ ××•×‘×™×œ ×œ×”×¦×œ×—×”!`;
            return base;
        }

        async function searchYouTube(query) {
            if (!YT_API_KEY) {
                alert('××™×Ÿ ××¤×ª×— YouTube API â€“ ×—×™×¤×•×© ××™× ×• ×–××™×Ÿ. × ×™×ª×Ÿ ×œ×”×“×‘×™×§ ×§×™×©×•×¨ MP3 ×™×©×™×¨×•×ª.');
                return;
            }
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=5&q=${encodeURIComponent(query)}&key=${YT_API_KEY}`;
            const resp = await fetch(url);
            const data = await resp.json();
            return data.items.map(v => ({ id: v.id.videoId, title: v.snippet.title }));
        }

        function selectSong(idOrUrl, title) {
            if (idOrUrl.startsWith('http')) {
                selectedSong = { type: 'url', url: idOrUrl, title };
            } else {
                selectedSong = { type: 'yt', id: idOrUrl, title };
            }
            const preview = document.getElementById('songPreview');
            preview.innerHTML = `<p class="small">× ×‘×—×¨: ${title}</p>`;
        }

        document.getElementById('useSong').addEventListener('change', () => {
            const container = document.getElementById('songContainer');
            container.style.display = document.getElementById('useSong').checked ? 'block' : 'none';
        });

        document.getElementById('searchBtn').addEventListener('click', async () => {
            const q = document.getElementById('songQuery').value.trim();
            if (!q) return;
            const preview = document.getElementById('songPreview');
            preview.innerHTML = '<p class="small">××—×¤×©â€¦</p>';

            if (q.match(/\.(mp3|wav|ogg)(\?.*)?$/i)) {
                preview.innerHTML = `
                    <audio controls src="${q}"></audio>
                    <button class="small" onclick="selectSong('${q}', '×§×•×‘×¥ MP3')">×‘×—×¨ ×§×•×‘×¥ ×–×”</button>
                `;
                return;
            }

            const results = await searchYouTube(q);
            if (results.length === 0) {
                preview.innerHTML = '<p class="small">×œ× × ××¦××• ×ª×•×¦××•×ª.</p>';
                return;
            }
            preview.innerHTML = results.map(r => `
                <div class="small" style="margin:.4rem 0;">
                    <b>${r.title}</b><br>
                    <iframe width="100%" height="80" src="https://www.youtube.com/embed/${r.id}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                    <button class="small" onclick="selectSong('${r.id}','${r.title.replace(/'/g,"\\'")}')">×‘×—×¨</button>
                </div>
            `).join('');
        });

        document.getElementById('msg').addEventListener('input', updateMsgPreview);
        document.getElementById('msgStyle').addEventListener('change', updateMsgPreview);
        document.getElementById('volume').addEventListener('input', () => {
            document.getElementById('volDisplay').textContent = document.getElementById('volume').value + '%';
        });

        function updateMsgPreview() {
            const txt = document.getElementById('msg').value.trim();
            const style = document.getElementById('msgStyle').value;
            const title = document.getElementById('title').value.trim() || '×”×ª×–×›×•×¨×ª';
            const out = txt || generateMessage(title, style);
            document.getElementById('messagePreview').textContent = out;
        }

        document.getElementById('addBtn').addEventListener('click', () => {
            const title = document.getElementById('title').value.trim();
            const timeStr = document.getElementById('time').value;
            const msgRaw = document.getElementById('msg').value.trim();
            const style = document.getElementById('msgStyle').value;
            const start = toSec(document.getElementById('startSec').value);
            const end = toSec(document.getElementById('endSec').value);
            const useSong = document.getElementById('useSong').checked;
            const volume = document.getElementById('volume').value;

            if (!title || !timeStr) {
                alert('×”×›× ×¡ ×©× ×•×–××Ÿ.');
                return;
            }

            const now = new Date();
            const [h, m] = timeStr.split(':').map(Number);
            const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0, 0);
            if (target <= now) target.setDate(target.getDate() + 1);
            const delay = target.getTime() - now.getTime();

            const reminder = {
                id: Date.now(),
                title,
                time: timeStr,
                target: target.getTime(),
                msg: msgRaw || generateMessage(title, style),
                useSong,
                song: useSong ? selectedSong : null,
                start,
                end,
                volume,
                active: true
            };

            reminders.push(reminder);
            saveReminders();
            renderList();
            schedule(reminder, delay);
            clearForm();
        });

        function saveReminders() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(reminders));
        }

        function renderList() {
            const list = document.getElementById('list');
            if (reminders.length === 0) {
                list.innerHTML = '<p class="small">××™×Ÿ ×ª×–×›×•×¨×•×ª ×¤×¢×™×œ×•×ª.</p>';
                return;
            }
            list.innerHTML = reminders.map(r => `
                <div class="small" style="margin:.6rem 0; padding:.6rem; background:#3a3a5a; border-radius:var(--radius);">
                    <b>${r.title}</b> â€“ ${new Date(r.target).toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' })}
                    <br>×”×•×“×¢×”: ${r.msg}
                    ${r.useSong ? `<br>×©×™×¨: ${r.song.title}` : ''}
                    <br><button class="small" onclick="deleteReminder(${r.id})">ğŸ—‘ï¸ ××—×§</button>
                </div>
            `).join('');
        }

        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            saveReminders();
            renderList();
        }

        function clearForm() {
            document.getElementById('title').value = '';
            document.getElementById('time').value = '';
            document.getElementById('songQuery').value = '';
            document.getElementById('songPreview').innerHTML = '';
            document.getElementById('msg').value = '';
            document.getElementById('msgStyle').value = 'normal';
            document.getElementById('messagePreview').textContent = '';
            document.getElementById('startSec').value = '';
            document.getElementById('endSec').value = '';
            document.getElementById('useSong').checked = false;
            document.getElementById('songContainer').style.display = 'none';
            selectedSong = null;
        }

        function schedule(rem, delay) {
            setTimeout(() => showNotification(rem), delay);
        }

        async function showNotification(rem) {
            if (Notification.permission !== 'granted') {
                await Notification.requestPermission();
            }

            const notif = new Notification(rem.title, {
                body: rem.msg,
                icon: 'https://img.icons8.com/ios-filled/50/000000/alarm.png'
            });

            if (rem.useSong && rem.song) {
                const audio = new Audio();
                if (rem.song.type === 'url') {
                    audio.src = rem.song.url;
                } else {
                    const start = rem.start || 0;
                    const end = rem.end || 0;
                    const src = `https://www.youtube.com/embed/${rem.song.id}?autoplay=1&start=${start}&end=${end}&controls=0`;
                    audio.src = src;
                }
                audio.volume = rem.volume / 100;
                audio.play().catch(() => {});
            }

            notif.onclick = () => { notif.close(); };
        }

        function init() {
            const now = Date.now();
            reminders.forEach(r => {
                if (r.active && r.target > now) {
                    schedule(r, r.target - now);
                }
            });
            renderList();
        }

        init();
    </script>
</body>
</html>
