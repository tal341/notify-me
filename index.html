<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>â° ×ª×–×›×•×¨×•×ª ×—×›××•×ª</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="https://img.icons8.com/ios-filled/50/000000/alarm.png">

<!-- ==== ×¢×™×¦×•×‘ ==== -->
<style>
:root{
    --bg:#1e1e2f;          /* ×¨×§×¢ ×›×”×” */
    --card:#2a2a3d;        /* ×›×¨×˜×™×¡×™× */
    --accent:#00ff88;      /* ×¦×‘×¢ ××•×“×’×© */
    --text:#e0e0ff;        /* ×˜×§×¡×˜ */
    --radius:12px;
    --shadow:0 4px 12px rgba(0,0,0,.4);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family:system-ui,Arial,Helvetica,sans-serif;
    background:var(--bg);
    color:var(--text);
    line-height:1.5;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:2rem 1rem;
}
.container{
    width:100%;
    max-width:560px;
}
h1{
    font-size:2.2rem;
    text-align:center;
    margin-bottom:1rem;
    color:var(--accent);
}
.card{
    background:var(--card);
    border-radius:var(--radius);
    padding:1.5rem;
    margin-bottom:1.5rem;
    box-shadow:var(--shadow);
}
input,select,textarea,button{
    width:100%;
    font-size:1rem;
    padding:.8rem 1rem;
    margin-top:.5rem;
    border:none;
    border-radius:var(--radius);
}
input,select,textarea{
    background:#3a3a5a;
    color:#fff;
}
button{
    background:var(--accent);
    color:#000;
    font-weight:bold;
    cursor:pointer;
    transition:transform .1s;
}
button:hover{transform:scale(1.02);}
button:active{transform:scale(.98);}
.small{font-size:.9rem;}
.mt{margin-top:1rem;}
.center{text-align:center;}
#songPreview{
    margin-top:.8rem;
    text-align:center;
}
#songPreview audio{
    width:100%;
    margin-top:.4rem;
}
#messagePreview{
    margin-top:.8rem;
    padding:.6rem;
    background:#3a3a5a;
    border-radius:var(--radius);
    font-style:italic;
}
@media (max-width:480px){
    h1{font-size:1.8rem;}
}
</style>
</head>

<body>
<div class="container">

    <h1>â° ×ª×–×›×•×¨×•×ª ×—×›××•×ª</h1>

    <!-- ====================  ×˜×•×¤×¡ ×™×¦×™×¨×ª ×ª×–×›×•×¨×ª ==================== -->
    <div class="card">
        <h2 class="small">ğŸ—’ï¸ ×©× & ×–××Ÿ</h2>
        <input id="title" type="text" placeholder="×©× ×”×ª×–×›×•×¨×ª (×œ×“×•×’××”: ×œ×§×—×ª ×ª×¨×•×¤×”)" required>
        <input id="time" type="time" required>

        <h2 class="small mt">ğŸµ ×©×™×¨ (××• ×§×™×©×•×¨ MP3)</h2>
        <input id="songQuery" type="text" placeholder="×—×¤×© ×‘×™â€‘×˜×•×‘ (YouTube) ××• ×”×“×‘×§ ×§×™×©×•×¨ MP3">
        <button id="searchBtn" class="small">ğŸ” ×—×¤×© ×©×™×¨</button>

        <div id="songPreview"></div>

        <h2 class="small mt">â±ï¸ ×§×˜×¢ ××”×©×™×¨ (××•×¤×¦×™×•× ×œ×™)</h2>
        <div class="small">×”×–× ×ª ×–××Ÿ ×‘×¤×•×¨××˜ <b>mm:ss</b> â€“ ×œ×“×•×’××” 00:30 (30 ×©× ×™×•×ª)</div>
        <input id="startSec" type="text" placeholder="×”×ª×—×œ×” (mm:ss)" class="small">
        <input id="endSec"   type="text" placeholder="×¡×™×•× (mm:ss)" class="small">

        <h2 class="small mt">ğŸ’¬ ×”×•×“×¢×” ××•×ª×××ª</h2>
        <textarea id="msg" rows="2" placeholder="×”×•×“×¢×” ×©×ª×•×¤×™×¢ (×× ×¨×™×§ â€“ × ×•×¦×¨×” ×”×•×“×¢×” ××•×˜×•××˜×™×ª)"></textarea>
        <select id="msgStyle" class="small">
            <option value="normal">×¨×’×™×œ×”</option>
            <option value="funny">×”×•××•×¨×™×¡×˜×™×ª</option>
            <option value="motiv">××¢×•×“×“×ª</option>
        </select>
        <div id="messagePreview"></div>

        <button id="addBtn" class="mt">âœ¨ ×”×•×¡×£ ×ª×–×›×•×¨×ª</button>
    </div>

    <!-- ====================  ×¨×©×™××ª ×ª×–×›×•×¨×•×ª ==================== -->
    <div class="card">
        <h2 class="small">ğŸ“‹ ×ª×–×›×•×¨×•×ª ×¤×¢×™×œ×•×ª</h2>
        <div id="list"></div>
    </div>

</div>

<!-- ==== ×§×•×“ JavaScript ==== -->
<script>
/* ====================  ×§×‘×•×¢×™× ×•×”×’×“×¨×•×ª ==================== */
const YT_API_KEY = '';               // <-- ×”×›× ×¡ ×›××Ÿ ××¤×ª×— YouTube Data API (×—×™× ×) ×× ×ª×¨×¦×” ×—×™×¤×•×© ×××™×ª×™
const YT_SEARCH_URL = 'https://www.googleapis.com/youtube/v3/search';
const YT_VIDEO_URL  = 'https://www.youtube.com/embed/';   // embed id
const STORAGE_KEY = 'smartReminders';
let reminders = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

/* ====================  ×¢×–×¨×™ ×–××Ÿ ==================== */
function toSec(str){                     // "mm:ss" â†’ ×©× ×™×•×ª
    const [m,s] = str.split(':').map(Number);
    return (isNaN(m)?0:m)*60 + (isNaN(s)?0:s);
}
function toMMSS(sec){
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
}

/* ====================  ×”×•×“×¢×•×ª AI (×¤×©×•×˜) ==================== */
function generateMessage(title, style){
    const base = `×”×™×™! ×”×’×™×¢ ×”×–××Ÿ ×œâ€‘${title}.`;
    if(style==='funny')   return `${base} ğŸ˜† ××œ ×ª×ª×Ÿ ×œ×©×¢×•×Ÿ ×œ×©×§×¨ ××•×ª×š!`;
    if(style==='motiv')   return `${base} ğŸ’ª ×ª×–×›×•×¨ â€“ ×›×œ ×¦×¢×“ ×§×˜×Ÿ ××•×‘×™×œ ×œ×”×¦×œ×—×”!`;
    return base; // normal
}

/* ====================  ×—×™×¤×•×© ×©×™×¨ ×‘×™â€‘×˜×•×‘ ==================== */
async function searchYouTube(query){
    if(!YOUTUBE_API_KEY){
        // ×œ×œ× ××¤×ª×— â€“ × ×¦×™×’ ×”×•×“×¢×” ×œ××©×ª××©
        alert('××™×Ÿ ××¤×ª×— YouTube API â€“ ×—×™×¤×•×© ××™× ×• ×–××™×Ÿ. × ×™×ª×Ÿ ×œ×”×“×‘×™×§ ×§×™×©×•×¨ MP3 ×™×©×™×¨×•×ª.');
        return;
    }
    const url = `${YT_SEARCH_URL}?part=snippet&type=video&maxResults=5&q=${encodeURIComponent(query)}&key=${YOUTUBE_API_KEY}`;
    const resp = await fetch(url);
    const data = await resp.json();
    return data.items.map(v=>({id:v.id.videoId, title:v.snippet.title}));
}

/* ====================  ×”×¦×’×ª ×ª×•×¦××•×ª ×—×™×¤×•×© ==================== */
async function handleSearch(){
    const q = document.getElementById('songQuery').value.trim();
    if(!q) return;
    const preview = document.getElementById('songPreview');
    preview.innerHTML = '<p class="small">××—×¤×©â€¦</p>';

    // ×× ×”×§×™×©×•×¨ ×”×•× MP3 ×™×©×™×¨ â€“ × ×¦×™×’ ×™×©×™×¨×•×ª
    if(q.match(/\.(mp3|wav|ogg)(\?.*)?$/i)){
        preview.innerHTML = `
            <audio controls src="${q}"></audio>
            <button class="small" onclick="selectSong('${q}','×§×•×‘×¥ MP3')">×‘×—×¨ ×§×•×‘×¥ ×–×”</button>
        `;
        return;
    }

    // ×—×™×¤×•×© ×‘×™â€‘×˜×•×‘ (×× ×™×© ××¤×ª×—)
    const results = await searchYouTube(q);
    if(results.length===0){
        preview.innerHTML = '<p class="small">×œ× × ××¦××• ×ª×•×¦××•×ª.</p>';
        return;
    }
    preview.innerHTML = results.map(r=>`
        <div class="small" style="margin:.4rem 0;">
            <b>${r.title}</b><br>
            <iframe width="100%" height="80" src="${YT_VIDEO_URL}${r.id}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            <button class="small" onclick="selectSong('${r.id}','${r.title.replace(/'/g,"\\'")}')">×‘×—×¨</button>
        </div>
    `).join('');
}

/* ====================  ×‘×—×™×¨×ª ×©×™×¨ ==================== */
let selectedSong = null;   // {type:'yt'|'url', id:..., title:...}
function selectSong(idOrUrl, title){
    if(idOrUrl.startsWith('http')){ // MP3 url
        selectedSong = {type:'url', url:idOrUrl, title};
    }else{
        selectedSong = {type:'yt', id:idOrUrl, title};
    }
    const preview = document.getElementById('songPreview');
    preview.innerHTML = `<p class="small">× ×‘×—×¨: ${title}</p>`;
}

/* ====================  ×ª×¦×•×’×ª ×”×•×“×¢×” ××•×ª×××ª ==================== */
document.getElementById('msg').addEventListener('input', updateMsgPreview);
document.getElementById('msgStyle').addEventListener('change', updateMsgPreview);
function updateMsgPreview(){
    const txt = document.getElementById('msg').value.trim();
    const style = document.getElementById('msgStyle').value;
    const title = document.getElementById('title').value.trim()||'×”×ª×–×›×•×¨×ª';
    const out = txt || generateMessage(title, style);
    document.getElementById('messagePreview').textContent = out;
}

/* ====================  ×”×•×¡×¤×ª ×ª×–×›×•×¨×ª ==================== */
document.getElementById('addBtn').addEventListener('click', addReminder);
function addReminder(){
    const title   = document.getElementById('title').value.trim();
    const timeStr = document.getElementById('time').value;
    const msgRaw  = document.getElementById('msg').value.trim();
    const style   = document.getElementById('msgStyle').value;
    const start   = toSec(document.getElementById('startSec').value);
    const end     = toSec(document.getElementById('endSec').value);

    if(!title || !timeStr){
        alert('×”×›× ×¡ ×©× ×•×–××Ÿ.');
        return;
    }
    if(!selectedSong){
        alert('×‘×—×¨ ×©×™×¨ ××• ×”×“×‘×§ ×§×™×©×•×¨ MP3.');
        return;
    }

    const now = new Date();
    const [h,m] = timeStr.split(':').map(Number);
    const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0, 0);
    // ×× ×”×–××Ÿ ×›×‘×¨ ×¢×‘×¨ ×”×™×•× â€“ ×§×‘×¢ ×œ×™×•× ×”×‘×
    if(target <= now) target.setDate(target.getDate()+1);
    const delay = target.getTime() - now.getTime();

    const reminder = {
        id: Date.now(),
        title,
        time: timeStr,
        target: target.getTime(),
        msg: msgRaw || generateMessage(title, style),
        song: selectedSong,
        start,
        end,
        active:true
    };
    reminders.push(reminder);
    saveReminders();
    renderList();
    schedule(reminder, delay);
    clearForm();
}

/* ====================  ×©××™×¨×ª/×˜×¢×™× ×ª ×ª×–×›×•×¨×•×ª ==================== */
function saveReminders(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(reminders));
}

/* ====================  ×¨×™× ×“×•×¨ ×¨×©×™××ª ×ª×–×›×•×¨×•×ª ==================== */
function renderList(){
    const list = document.getElementById('list');
    if(reminders.length===0){
        list.innerHTML = '<p class="small">××™×Ÿ ×ª×–×›×•×¨×•×ª ×¤×¢×™×œ×•×ª.</p>';
        return;
    }
    list.innerHTML = reminders.map(r=>`
        <div class="small" style="margin:.6rem 0; padding:.6rem; background:#3a3a5a; border-radius:var(--radius);">
            <b>${r.title}</b> â€“ ${new Date(r.target).toLocaleTimeString('he-IL', {hour:'2-digit',minute:'2-digit'})}
            <br>×”×•×“×¢×”: ${r.msg}
            <br>×©×™×¨: ${r.song.title}
            <br><button class="small" onclick="deleteReminder(${r.id})">ğŸ—‘ï¸ ××—×§</button>
        </div>
    `).join('');
}

/* ====================  ××—×™×§×ª ×ª×–×›×•×¨×ª ==================== */
function deleteReminder(id){
    reminders = reminders.filter(r=>r.id!==id);
    saveReminders();
    renderList();
}

/* ====================  × ×™×§×•×™ ×˜×•×¤×¡ ==================== */
function clearForm(){
    document.getElementById('title').value='';
    document.getElementById('time').value='';
    document.getElementById('songQuery').value='';
    document.getElementById('songPreview').innerHTML='';
    document.getElementById('msg').value='';
    document.getElementById('msgStyle').value='normal';
    document.getElementById('messagePreview').innerHTML='';
    document.getElementById('startSec').value='';
    document.getElementById('endSec').value='';
    selectedSong=null;
}

/* ====================  ×ª×–××•×Ÿ ×”×ª×¨××” ==================== */
function schedule(rem, delay){
    // ×× ×”×“×¤×“×¤×Ÿ ×¡×’×•×¨ â€“ × ×©×ª××© ×‘â€‘setTimeout ×¨×§ ×‘×–××Ÿ ×¤×ª×•×—.
    // ×‘××¦×‘ ×©×œ GitHub Pages ×–×” ××¡×¤×™×§.
    setTimeout(()=>showNotification(rem), delay);
}

/* ====================  ×”×¦×’×ª ×”×ª×¨××” ==================== */
async function showNotification(rem){
    // 1ï¸âƒ£ ×‘×§×©×ª ×”×¨×©××” (××ª×‘×¦×¢×ª ×¨×§ ×‘×¤×¢× ×”×¨××©×•× ×”)
    if(Notification.permission!=='granted'){
        await Notification.requestPermission();
    }

    // 2ï¸âƒ£ ×™×¦×™×¨×ª ×”×”×ª×¨××”
    const notif = new Notification(rem.title, {
        body: rem.msg,
        icon: 'https://img.icons8.com/ios-filled/50/000000/alarm.png'
    });

    // 3ï¸âƒ£ × ×’×Ÿ ××ª ×”×©×™×¨ (××• ×§×˜×¢ ××× ×•)
    const audio = new Audio();
    if(rem.song.type==='url'){
        audio.src = rem.song.url;
    }else{
        // YouTube embed â€“ × ×©×ª××© ×‘â€‘YouTube Iframe API ×›×“×™ ×œ×§×‘×œ ×§×•×‘×¥ MP3?
        // ×”×¤×ª×¨×•×Ÿ ×”×¤×©×•×˜: × ×©×ª××© ×‘â€‘youtube-nocookie.com ×¢× autoplay ×•â€‘start/end
        const start = rem.start||0;
        const end   = rem.end||0;
        const src = `https://www.youtube.com/embed/${rem.song.id}?autoplay=1&start=${start}&end=${end}&controls=0`;
        audio.src = src; // ×–×” ×™×¤×¢×œ ×¨×§ ×‘××›×©×™×¨×™ ××•×‘×™×™×œ ×¢× ××¤×©×¨×•×ª autoplay
    }
    audio.volume = 0.7;
    audio.play().catch(()=>{}); // ×‘××™×“×” ×©×”×“×¤×“×¤×Ÿ ×—×•×¡× autoplay

    // 4ï¸âƒ£ ×›×¤×ª×•×¨ "×”×‘× ×ª×™" â€“ ×¡×•×’×¨ ××ª ×”×”×ª×¨××”
    notif.onclick = ()=>{ notif.close(); audio.pause(); };
}

/* ====================  ××ª×—×•×œ ×¨××©×•× ×™ ==================== */
function init(){
    // ×× ×™×© ×ª×–×›×•×¨×•×ª ×©××™×•×¢×“×•×ª ×œ×¢×ª×™×“ â€“ × ×–××Ÿ ××•×ª×Ÿ ××—×“×©
    const now = Date.now();
    reminders.forEach(r=>{
        if(r.active && r.target>now){
            schedule(r, r.target-now);
        }
    });
    renderList();
}
init();

/* ====================  ××™×¨×•×¢×™ ×œ×—×¦× ×™× ==================== */
document.getElementById('searchBtn').addEventListener('click', handleSearch);
</script>
</body>
</html>
