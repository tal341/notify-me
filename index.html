<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>⏰ תזכורות עובדות</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial, sans-serif;
  background:#1e1e2f; color:white;
  display:flex; justify-content:center;
  padding:20px;
}
.container{max-width:600px; width:100%;}
.card{
  background:#2a2a3d; padding:20px;
  border-radius:12px; margin-bottom:20px;
}
input,textarea,button{
  width:100%; margin:5px 0; padding:10px;
  border-radius:8px; border:none;
  font-size:16px;
}
button{background:#00ff88; color:black; font-weight:bold; cursor:pointer;}
button:hover{opacity:0.8;}
.reminder{background:#3a3a5a;padding:10px;border-radius:8px;margin:5px 0;}
</style>
</head>
<body>
<div class="container">
  <h1>⏰ תזכורות עובדות</h1>
  
  <div class="card">
    <input id="title" placeholder="שם התזכורת">
    <input id="time" type="time">
    <input id="date" type="date">
    <textarea id="msg" placeholder="הודעה שתופיע"></textarea>
    
    <h3>שיר / צליל (אופציונלי)</h3>
    <input id="sound" placeholder="קישור mp3 ישיר או ריק">
    <label>עוצמה: <span id="volVal">70%</span></label>
    <input id="volume" type="range" min="0" max="100" value="70">
    
    <button onclick="addReminder()">➕ הוסף תזכורת</button>
  </div>
  
  <div class="card">
    <h3>תזכורות פעילות</h3>
    <div id="list"></div>
  </div>
</div>

<script>
let reminders = JSON.parse(localStorage.getItem("reminders")||"[]");

function save(){ localStorage.setItem("reminders", JSON.stringify(reminders)); }

function render(){
  const div=document.getElementById("list");
  if(reminders.length===0){div.innerHTML="אין תזכורות"; return;}
  div.innerHTML="";
  reminders.forEach(r=>{
    const d=document.createElement("div");
    d.className="reminder";
    d.innerHTML=`<b>${r.title}</b> | ${r.date} ${r.time}<br>${r.msg}`;
    div.appendChild(d);
  });
}

function addReminder(){
  const title=document.getElementById("title").value.trim();
  const time=document.getElementById("time").value;
  const date=document.getElementById("date").value;
  const msg=document.getElementById("msg").value.trim()||`זמן ל: ${title}`;
  const sound=document.getElementById("sound").value.trim();
  const volume=document.getElementById("volume").value/100;
  
  if(!title||!time||!date){alert("מלא שם, תאריך ושעה");return;}
  const id=Date.now();
  const target=new Date(`${date}T${time}:00`).getTime();
  
  const r={id,title,date,time,msg,sound,volume,target,active:true};
  reminders.push(r); save(); render();
  
  const delay=r.target-Date.now();
  if(delay>0) setTimeout(()=>notify(r), delay);
  else alert("הזמן עבר...");
}

function notify(r){
  if(!r.active) return;
  // התראה דפדפן
  if("Notification" in window){
    if(Notification.permission==="granted")
      new Notification(r.title, {body:r.msg});
    else if(Notification.permission!=="denied")
      Notification.requestPermission().then(p=>{
        if(p==="granted") new Notification(r.title,{body:r.msg});
      });
  }
  // צליל
  if(r.sound){
    const audio=new Audio(r.sound);
    audio.volume=r.volume;
    audio.play().catch(()=>alert("הצליל לא נטען (ודא שזה mp3 ישיר)"));
  }else{
    // ברירת מחדל קצרה
    const beep=new Audio("https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3");
    beep.volume=r.volume;
    beep.play();
  }
  // סמן כלא פעילה
  r.active=false; save(); render();
}

document.getElementById("volume").oninput=e=>{
  document.getElementById("volVal").textContent=e.target.value+"%";
};

// בדוק תזכורות אחרי טעינה
function init(){
  render();
  reminders.forEach(r=>{
    if(r.active){
      const delay=r.target-Date.now();
      if(delay>0) setTimeout(()=>notify(r), delay);
    }
  });
}
init();
</script>
</body>
</html>
